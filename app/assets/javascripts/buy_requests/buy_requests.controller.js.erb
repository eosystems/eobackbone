'use strict';

angular.module('eoApp')

.controller(
  'buyRequestsController',
  ['$resource', '$scope', '$state', '$uibModal', '$loading', 'toastr', '$location',
    function($resource, $scope, $state, $uibModal, $loading, toastr, $location) {
    var Api = $resource("/api/sell_orders", {}, {
      create: {
        method: 'POST'
      }
    });
    var LocationApi = $resource("/api/locations", {});
    var DepartmentApi = $resource("/api/departments", {});

    var that = this;
    $scope.requestItems = new Array();

    // 初期化
    var initialize = function() {
      // 部門
      DepartmentApi.get({}).$promise.then(function(data) {
        $scope.departments = data.results;
      });
    };

    initialize();

    $scope.addToRequestList = function(typeId) {
        console.log ("add to request");
        var item = new Object();
        item.type_name = "tritanium";
        item.type_id = typeId;
        item.quantity = 1;
        item.buy_unit_price = 3.45;
        item.buy_price = 3.45;
        item.sell_unit_price = 4.2;
        item.sell_price = 4.2;

        $scope.requestItems.push(item);

        toastr.info("Add to Request List" + " (" + item.type_name + ")", "Info");
    };

    $scope.changeQuantity = function(row) {
      row.sell_price = row.sell_unit_price * row.quantity;
      row.buy_price = row.buy_unit_price * row.quantity;
    }

    $scope.removeRequestList = function(index) {
      $scope.requestItems.splice(index,1);
    }

  }]
);
